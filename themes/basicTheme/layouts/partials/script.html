<script>
    var query = window.location.search;
    console.log(query);

    const currentURL = document.baseURI; // gets the url of the page the iframe is embedded in even with different origins

    if (self != top) {
        console.log("Removed iframe #header and #footer");
        document.getElementById("header").remove();
        document.getElementById("footer").remove();
        document.body.style.overflow = "hidden";
    }

    // For sending iframe height multiple times and then stopping on first page load
    // could be fized with proper Canvas Listening
    function setIntervalX(callback, delay, repetitions) {
        var x = 0;
        var intervalID = window.setInterval(function () {

            callback();

            if (++x === repetitions) {
                window.clearInterval(intervalID);
            }
        }, delay);
    }

    // sends postMessage to parent page with hight information
    function sendIframeHeight() {
        window.top.postMessage(JSON.stringify({
            subject:
                "lti.frameResize", height: document.documentElement.scrollHeight + "px"
        }), "*");


    }

    document.addEventListener('DOMContentLoaded', function () {

        // This will be repeated 10 times with .01 second intervals:
        setIntervalX(function () {
            // Your logic here

            sendIframeHeight();
        }, 10, 10);
        console.log("DOMContentLoaded");
        console.log("iframe scrollHeight: " + document.documentElement.scrollHeight + "px");

    });

    var resizeTimer;
    // send new iframe height postMessage if window is resized
    window.onresize = function () {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(function () {
            console.log("Window Resized");
            console.log("New iframe scrollHeight: " + document.documentElement.scrollHeight + "px");
            sendIframeHeight();
        }, 100);
    };



    //window.addEventListener('message', console.log)

    window.addEventListener('message', messageListener, false);

    function messageListener(event) {
        console.log(event.data);
    }


    /*
        // Set theme to the user's preferred color scheme dark or light mode
        function updateTheme() {
            const colorMode = window.matchMedia("(prefers-color-scheme: dark)").matches
                ? "dark"
                : "light";
            document.querySelector("html").setAttribute("data-bs-theme", colorMode);
        }
    
        // Set theme on load
        updateTheme()
    
        // Update theme when the preferred scheme changes
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', updateTheme)
    */

</script>